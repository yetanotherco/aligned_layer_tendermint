"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.plugin = void 0;
var _ast = require("@osmonauts/ast");
var plugin = function plugin(builder, bundler) {
  if (!builder.options.bundle.enabled) {
    return;
  }

  // [x] bundle
  var body = (0, _ast.recursiveModuleBundle)(builder.options, bundler.bundle.bundleVariables);
  var prog = [].concat(bundler.bundle.importPaths).concat(body);
  var localname = bundler.bundle.bundleFile;
  var filename = bundler.getFilename(localname);
  bundler.writeAst(prog, filename);

  // [x] write an index file for each base
  bundler.files.forEach(function (file) {
    return builder.files.push(file);
  });
};
exports.plugin = plugin;